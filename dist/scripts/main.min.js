/*! build by steve */"use strict";function dateFormatter(a){var b=new Date(a);return b.format("yyyy-MM-dd hh:mm:ss")}function QueryStringToJSON(a){var b=a.search.slice(1).split("&"),c={};return b.forEach(function(a){a=a.split("="),c[a[0]]=decodeURIComponent(a[1]||"")}),JSON.parse(JSON.stringify(c))}function pagerFilter(a){"number"==typeof a.length&&"function"==typeof a.splice&&(a={total:a.length,rows:a});var b=$(this),c=b.datagrid("options"),d=b.datagrid("getPager");d.pagination({onSelectPage:function(e,f){c.pageNumber=e,c.pageSize=f,d.pagination("refresh",{pageNumber:e,pageSize:f}),b.datagrid("loadData",a)}}),a.originalRows||(a.originalRows=a.rows);var e=(c.pageNumber-1)*parseInt(c.pageSize),f=e+parseInt(c.pageSize);return a.rows=a.originalRows.slice(e,f),a}function getSelectedRow(a){var b=a.datagrid("getSelected");return b?b:void 0}function tabClose(){$(".tabs-inner").dblclick(function(){var a=$(this).children(".tabs-closable").text();$("#tabs").tabs("close",a)}),$(".tabs-inner").bind("contextmenu",function(a){$("#tab_memu_id").menu("show",{left:a.pageX,top:a.pageY});var b=$(this).children(".tabs-closable").text();return $("#tab_memu_id").data("currtab",b),$("#tabs").tabs("select",b),!1})}function tabCloseEven(){$("#mm-tabupdate").click(function(){var a=$("#tabs").tabs("getSelected"),b=$(a.panel("options").content).attr("src");$("#tabs").tabs("update",{tab:a,options:{url:b}})}),$("#mm-tabclose").click(function(){var a=$("#tab_memu_id").data("currtab");$("#tabs").tabs("close",a)}),$("#mm-tabcloseall").click(function(){$(".tabs-inner span").each(function(a,b){var c=$(b).text();$("#tabs").tabs("close",c)})}),$("#mm-tabcloseother").click(function(){$("#mm-tabcloseright").click(),$("#mm-tabcloseleft").click()}),$("#mm-tabcloseright").click(function(){var a=$(".tabs-selected").nextAll();return 0===a.length?!1:(a.each(function(a,b){var c=$("a:eq(0) span",$(b)).text();$("#tabs").tabs("close",c)}),!1)}),$("#mm-tabcloseleft").click(function(){var a=$(".tabs-selected").prevAll();return 0===a.length?!1:(a.each(function(a,b){var c=$("a:eq(0) span",$(b)).text();$("#tabs").tabs("close",c)}),!1)}),$("#mm-exit").click(function(){$("#tab_memu_id").menu("hide")})}function init(){$(function(){setInterval("getDateTime()",1e3)}),initLeftMenu(),$(function(){$("#theme_id").tooltip({content:$("<div></div>"),showEvent:"click",onUpdate:function(a){a.panel({width:200,border:!1,title:"Change Themes",href:"app/theme/index.html"})},onShow:function(){var a=$(this);a.tooltip("tip").unbind().bind("mouseenter",function(){a.tooltip("show")}).bind("mouseleave",function(){a.tooltip("hide")})}})}),$(function(){tabClose(),tabCloseEven(),onAddTab(),onLoadTab(),onUpdateTab()})}function logout(){oauth2.user.logout()}function login(){var a=$("#login_email").val(),b=$("#login_password").val();oauth2.user.login(a,b,function(a){a?(msgAlert("login failed","please check email and password"),console.log(a.responseText),$("#login_win").window("close"),msgShow("Success","Login success!"),$("#person_detail_id").text("debug"),init()):oauth2.user.get(function(){$("#login_win").window("close"),msgShow("Success","Login success!"),$("#person_detail_id").text(oauth2.user.user.emailAddress),init()})})}function oauth2(){}function getModuleDetail(){var a=QueryStringToJSON(window.location);oauth2.getWithAuth("/admin/modules/"+a.id+"/tree/",function(a){var b=a;$("#edit_module_form").form("load",{name:b.name,description:b.description,updateTime:dateFormatter(b.updateTime),createTime:dateFormatter(b.createTime),id:b.id}),$("#module_tree").tree({data:a,formatter:function(a){return a.name},loadFilter:myLoadFilter,onClick:function(a){a.onSelect()},onContextMenu:function(a,b){a.preventDefault(),b.onSelect(),b.id&&"folder"==b.type&&$("#folder_context_menu").menu("show",{left:a.pageX,top:a.pageY}),b.id&&"entity"==b.type&&$("#entity_context_menu").menu("show",{left:a.pageX,top:a.pageY}),b.id&&"report"==b.type&&$("#report_context_menu").menu("show",{left:a.pageX,top:a.pageY})}}),ajaxLoadEnd()},function(a){ajaxLoadEnd(),msgError(a)})}function updateModule(){var a=$("#edit_module_form"),b=a.serializeObject();oauth2.putWithAuth("/admin/modules/"+b.id+"/",b,function(a){ajaxLoadEnd(),getModuleDetail()},function(a){ajaxLoadEnd(),msgError(a)})}function loadSubNode(a){return"folder"==a.type?loadSubFolder(a):void 0}function removeChildren(a){$("#module_tree").tree("getChildren",a.target).forEach(function(a){$("#module_tree").tree("remove",a.target)})}function loadSubFolder(a,b){a.children=[],ajaxLoading(),oauth2.getWithAuth("/admin/folders/"+a.id+"/sub_folder/",function(c){c.forEach(function(a){a.state="closed",a.onSelect=function(){selectFolder(a)}});var d=c;oauth2.getWithAuth("/admin/folders/"+a.id+"/reports/",function(c){removeChildren(a),c.forEach(function(a){a.onSelect=function(){selectReport(a)},d.push(a)}),$("#module_tree").tree("append",{parent:a.target,data:d}).tree("expand",a.target),a.state="open","function"==typeof b&&b(a),ajaxLoadEnd()},function(a){ajaxLoadEnd(),msgError(a)}),ajaxLoadEnd()},function(a){ajaxLoadEnd(),msgError(a)})}function myLoadFilter(a,b){if(!a.type)return a;if("module"==a.type){var c=[];if(a.entities){var d={name:"entities",moduleId:a.id,children:a.entities,iconCls:"icon-man"};d.onSelect=function(){$("#edit_entity_node").css("display","none"),$("#edit_node").css("display",""),$("#edit_report_node").css("display","none"),showChildrenInDataGrid(d),taglePropertyForm(!1)},a.entities.forEach(function(a){a.onSelect=function(){selectEntity(a)}}),c.push(d)}if(a.folders){var e={name:"folders",moduleId:a.id,children:a.folders};a.folders.forEach(function(a){a.state="closed",a.onSelect=function(){selectFolder(a)}}),e.onSelect=function(){$("#edit_entity_node").css("display","none"),$("#edit_node").css("display",""),$("#edit_report_node").css("display","none"),showChildrenInDataGrid(e),taglePropertyForm(!1)},c.push(e)}return c}"folder"==a.type&&(a.onSelect=function(){console.log(a)})}function taglePropertyForm(a){a?$("#edit_select_folder_form").css("display",""):$("#edit_select_folder_form").css("display","none")}function selectEntity(a){ajaxLoading(),taglePropertyForm(!0),$("#edit_entity_node").css("display",""),$("#edit_node").css("display","none"),$("#edit_report_node").css("display","none"),oauth2.getWithAuth("/admin/entities/"+a.id,function(a){$("#edit_select_entity_form").form("load",{name:a.name,description:a.description,updateTime:dateFormatter(a.updateTime),createTime:dateFormatter(a.createTime),id:a.id}),$("#entity_field_grid").datagrid({loadFilter:pagerFilter}).datagrid("loadData",a.fields),ajaxLoadEnd()},function(a){ajaxLoadEnd(),msgError(a)})}function updateElement(){var a=getSelectedNode();"folder"==a.type?updateFolder():"entity"==a.type?updateEntity():a.id||"entities"!=a.name||createEntity()}function updateEntity(){var a=getSelectedNode();console.log(a),ajaxLoading();var b=$("#edit_select_entity_form").serializeObject();a.id=b.id,a.name=b.name,a.description=b.description,console.log(a),a.fields=$("#entity_field_grid").datagrid("getData").rows,oauth2.putWithAuth("/admin/entities/"+b.id+"/",a,function(b){a.id=b.id,a.createTime=b.createTime,a.updateTime=b.updateTime,a.description=b.description,a.name=b.name,$("#module_tree").tree("update",a),selectEntity(a),ajaxLoadEnd()},function(a){ajaxLoadEnd(),msgError(a)})}function createEntity(){ajaxLoading();var a=$("#edit_select_entity_form").serializeObject();a.fields=$("#entity_field_grid").datagrid("getData").rows,console.log(a);var b=QueryStringToJSON(window.location);oauth2.postAuth("/admin/modules/"+b.id+"/entities/",a,function(b){a.id=b.id,a.createTime=b.createTime,a.updateTime=b.updateTime,a.description=b.description,a.name=b.name,getModuleDetail(),ajaxLoadEnd()},function(a){ajaxLoadEnd(),msgError(a)})}function selectFolder(a){console.log(a.state),$("#edit_entity_node").css("display","none"),$("#edit_node").css("display",""),$("#edit_report_node").css("display","none"),"open"==a.state?$("#module_tree").tree("collapse",a.target):($("#module_tree").tree("getChildren",a.target).forEach(function(a){$("#module_tree").tree("remove",a.target)}),taglePropertyForm(!0),$("#edit_select_folder_form").form("load",{name:a.name,description:a.description,updateTime:dateFormatter(a.updateTime),createTime:dateFormatter(a.createTime),id:a.id}),showChildrenInDataGrid(a),"closed"==a.state&&loadSubFolder(a,showChildrenInDataGrid))}function getSelectedNode(){return $("#module_tree").tree("getSelected")}function updateFolder(){ajaxLoading();var a=$("#edit_select_folder_form").serializeObject();oauth2.putWithAuth("/admin/folders/"+a.id+"/",a,function(a){var b=getSelectedNode();b.id=a.id,b.createTime=a.createTime,b.updateTime=a.updateTime,b.description=a.description,b.name=a.name,console.log(b),$("#module_tree").tree("update",b),ajaxLoadEnd()},function(a){ajaxLoadEnd(),msgError(a)})}function showChildrenInDataGrid(a){void 0==a?$("#data_grid_div").css("display","none"):($("#data_grid_div").css("display",""),a.children?$("#root_folders_grid").datagrid({loadFilter:pagerFilter}).datagrid("loadData",a.children):$("#root_folders_grid").datagrid({loadFilter:pagerFilter}).datagrid("loadData",[]))}function showAddRootFolder(){("folder"==getSelectedNode().type||!getSelectedNode().type&&"folders"==getSelectedNode().name)&&$("#create_folder_win").window("open"),getSelectedNode().type||"entities"!=getSelectedNode().name||showAddEntity()}function createFolder(a){var b=a.serializeObject(),c=getSelectedNode().id;if(c)oauth2.postAuth("/admin/folders/"+c+"/sub_folder/",b,function(a){selectFolder(getSelectedNode()),selectFolder(getSelectedNode()),$("#create_folder_win").window("close")},function(a){ajaxLoadEnd(),msgError(a)});else{var d=getSelectedNode().moduleId;oauth2.postAuth("/admin/modules/"+d+"/folders/",b,function(a){getModuleDetail(),$("#create_folder_win").window("close")},function(a){ajaxLoadEnd(),msgError(a)})}}function editRootFolder(){var a=$("#root_folders_grid").datagrid("getSelected");console.log(a);var b=$("#module_tree").tree("find",a.id);$("#module_tree").tree("select",b.target),b.onSelect()}function deleteNode(){var a=getSelectedNode();a.type&&("folder"==a.type&&deleteFolder(a),"entity"==a.type&&deleteEntity(a),"report"==a.type&&deleteReport(a))}function deleteReport(a){ajaxLoading(),oauth2.deleteWithAuth("/admin/reports/"+a.id+"/",function(a){ajaxLoadEnd(),getModuleDetail()},function(a){console.log(a),ajaxLoadEnd(),200==a.status?(msgAlert("Success","Deleted!"),getModuleDetail()):msgError(a)})}function deleteEntity(a){ajaxLoading(),oauth2.deleteWithAuth("/admin/entities/"+a.id+"/",function(a){ajaxLoadEnd(),getModuleDetail()},function(a){console.log(a),ajaxLoadEnd(),200==a.status?(msgAlert("Success","Deleted!"),getModuleDetail()):msgError(a)})}function showAddReport(){var a=getSelectedNode().id;$("#edit_entity_node").css("display","none"),$("#edit_node").css("display","none"),$("#edit_report_node").css("display",""),$("#edit_select_report_form").form("load",{name:"",description:"",updateTime:"",createTime:"",folderId:a,id:void 0}),iniTiny(),tinyMCE.get("report_content").getBody().innerHTML=""}function iniTiny(){tinymce.init({selector:"#report_content",br_in_pre:!1,height:400,encoding:"xml",extended_valid_elements:"field[id|name]",custom_elements:"~field",plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste code"],toolbar:"insert_field insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",content_css:["//fast.fonts.net/cssapi/e6dc9b99-64fe-4292-ad98-6974f93cd2a2.css","//www.tinymce.com/css/codepen.min.css"],setup:function(a){a.addButton("insert_field",{text:"Insert New Field",icon:!1,type:"menubutton",menu:getEntitiesAndFieldForMenu(a)})}})}function selectReport(){iniTiny(),ajaxLoading();var a=getSelectedNode();$("#edit_entity_node").css("display","none"),$("#edit_node").css("display","none"),$("#edit_report_node").css("display",""),$("#edit_select_report_form").form("load",{name:a.name,description:a.description,updateTime:dateFormatter(a.updateTime),createTime:dateFormatter(a.createTime),id:a.id,folderId:a.folderId}),tinyMCE.get("report_content").getBody().innerHTML="",oauth2.getWithAuth("/admin/reports/"+a.id+"/",function(a){$.ajax({url:a.content,success:function(a){tinyMCE.get("report_content").getBody().innerHTML=a,console.log(a),ajaxLoadEnd()},error:function(a){ajaxLoadEnd(),msgAlert(a.statusText,"File Not Found!","i")}})},function(a){msgError(a)})}function getEntitiesAndFieldForMenu(a){var b=$("#module_tree").tree("getRoots"),c=b[0].children,d=[];return c.forEach(function(b){var c={text:b.name,menu:[]};b.fields.forEach(function(d){c.menu.push({text:d.name,onclick:function(){a.insertContent('<span style="text-decoration: underline;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<field id=\''+d.id+"' name='"+b.name+"_"+d.name+"'></field>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>")}})}),d.push(c)}),d}function checkReport(a){try{var b='<?xml version="1.1" ?><!DOCTYPE naughtyxml [<!ENTITY nbsp "&#0160;"><!ENTITY copy "&#0169;"><!ENTITY rsquo   "&#x20199;"><!ENTITY ldquo   "&#8220;"><!ENTITY rdquo   "&#8221;"><!ENTITY ndash  "&#x2013;" > <!ENTITY mdash  "&#x2014;" ><!ENTITY lsquo   "&#8216;">]>	';a="<body>"+a+"</body>";$.parseXML(b+a);return a}catch(c){return console.log(c),msgAlert("Error",'Please check the format, click Tools--> Source Code, copy all code and go to  <a hrel="http://www.freeformatter.com/xml-formatter.html">http://www.freeformatter.com/xml-formatter.html</a>'),!1}}function updateReport(){var a=$("#edit_select_report_form").serializeObject(),b=tinyMCE.get("report_content").getContent(),c=checkReport(b);c&&(a.content=c,console.log(c),console.log("report format pass"),a.id?(ajaxLoading(),oauth2.putWithAuth("/admin/reports/"+a.id+"/",a,function(a){ajaxLoadEnd()},function(a){console.log(a),200!=a.status?msgError(a):msgAlert("Success","Success","i"),ajaxLoadEnd()})):(ajaxLoading(),oauth2.postAuth("/admin/folders/"+a.folderId+"/reports/",a,function(a){ajaxLoadEnd()},function(a){console.log(a),ajaxLoadEnd(),msgError(a)})))}function deleteFolder(a){ajaxLoading(),oauth2.deleteWithAuth("/admin/folders/"+a.id+"/",function(a){ajaxLoadEnd(),getModuleDetail()},function(a){console.log(a),ajaxLoadEnd(),200==a.status?(msgAlert("Success","Deleted!"),getModuleDetail()):msgError(a)})}function endEditing(){return void 0==editIndex?!0:$("#entity_field_grid").datagrid("validateRow",editIndex)?($("#entity_field_grid").datagrid("endEdit",editIndex),editIndex=void 0,!0):!1}function onClickRow(a){editIndex!=a&&(endEditing()?($("#entity_field_grid").datagrid("selectRow",a).datagrid("beginEdit",a),editIndex=a):$("#entity_field_grid").datagrid("selectRow",editIndex))}function append(){console.log("adding"),endEditing()&&(console.log("adding..."),$("#entity_field_grid").datagrid("appendRow",{id:""}),editIndex=$("#entity_field_grid").datagrid("getRows").length-1,$("#entity_field_grid").datagrid("selectRow",editIndex).datagrid("beginEdit",editIndex))}function removeit(){void 0!=editIndex&&($("#entity_field_grid").datagrid("cancelEdit",editIndex).datagrid("deleteRow",editIndex),editIndex=void 0)}function accept(){endEditing()&&$("#entity_field_grid").datagrid("acceptChanges")}function reject(){$("#entity_field_grid").datagrid("rejectChanges"),editIndex=void 0}function getChanges(){var a=$("#entity_field_grid").datagrid("getChanges");alert(a.length+" rows are changed!")}function showAddEntity(){taglePropertyForm(!0),$("#edit_entity_node").css("display",""),$("#edit_node").css("display","none"),$("#edit_report_node").css("display","none"),$("#edit_select_entity_form").form("load",{name:"",description:"",updateTime:"",createTime:"",id:""}),$("#entity_field_grid").datagrid({loadFilter:pagerFilter}).datagrid("loadData",[])}function createModule(a){ajaxLoading("Loading..."),oauth2.postAuth("/admin/modules/",a.serializeObject(),function(a){ajaxLoadEnd(),getModules(),$("#create_module_win").window("close")},function(a){console.log(a),ajaxLoadEnd(),msgAlert(a.responseJSON.consumerMessage,a.responseJSON.applicationMessage)})}function getModules(){ajaxLoading("Loading..."),oauth2.getWithAuth("/admin/modules/",function(a){$("#modules_grid").datagrid({loadFilter:pagerFilter}).datagrid("loadData",a),ajaxLoadEnd()},function(a){console.log(a),ajaxLoadEnd(),msgAlert(a)})}function editModule(){var a=getSelectedRow($("#modules_grid"));console.log(a),addTabContent(a.name+"_"+a.id,"app/modules/edit_module.html?"+jsonToUrl(a),!0)}function showCreateModule(){$("#create_module_win").window("open")}oauth2.cookie={},oauth2.cookie.get=function(a){var b=document.cookie.split(/\; /g),c={};for(var d in b){var e=b[d].split(/\=/);c[e[0]]=unescape(e[1])}return c[a]},oauth2.cookie.remove=function(a){document.cookie=a+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},oauth2.cookie.set=function(a,b){document.cookie=a+"="+b},Date.prototype.format=function(a){var b={"y+":this.getFullYear(),"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1===RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a},$.fn.serializeObject=function(){var a={},b=this.serializeArray();return $.each(b,function(){a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a};var jsonToUrl=function(a){if(!JSON.stringify(a))return"";var b=[];for(var c in a)b.push(c+"="+a[c]);return b.join("&")},changeThemeFun=function(a){var b=$("#easyui_theme_id"),c=b.attr("href"),d=c.substring(0,c.indexOf("themes"))+"themes/"+a+"/easyui.css";b.attr("href",d);var e=$("iframe");if(e.length>0)for(var f=0;f<e.length;f++){var g=e[f];$(g).contents().find("#easyuiTheme").attr("href",d)}$.cookie("easyuiThemeName",a,{expires:7,path:"/"})};$.cookie("easyuiThemeName")&&changeThemeFun($.cookie("easyuiThemeName"));var ajaxLoading=function(a){"undefined"==typeof arguments[0]&&(a="loading..."),$("<div class='datagrid-mask'></div>").css({display:"block",width:"100%",height:$(window).height()}).appendTo("body"),$("<div class='datagrid-mask-msg'></div>").html(a).appendTo("body").css({display:"block",left:($(document.body).outerWidth(!0)-190)/2,top:($(window).height()-45)/2})},ajaxLoadEnd=function(){$(".datagrid-mask").remove(),$(".datagrid-mask-msg").remove()},initLeftMenu=function(){$.ajax({type:"GET",url:"data/left-menu.json",dataType:"json",success:function(a){if(a){var b=a,c="";$.each(b,function(a,b){var d=b.group,e=b.data,f=b.icon;c="<ul>",$.each(e,function(a,b){var d=b.title,e=b.icon,f=b.url,g=b.type;c+='<li><div ><a href="javascript:void(0);" class="easyui-linkbutton" plain="true" ',c+='onclick="javascript:addTab('+g+",'"+d+"','"+f+"');return false;\">",c+='<img src="'+e+'" />'+d+" </a></div></li>"}),c+="</ul>",$("#left_menu_content_id").accordion("add",{title:d,content:c,iconCls:f})}),$("#left_menu_content_id").accordion("select",0)}},error:function(){alert.show("失败")}})},getDateTime=function(){var a=["SUN","MON","FEB","WEN","THUR","FRI","SAT"],b=new Date,c=a[b.getDay()],d=b.format("yyyy-MM-dd hh:mm:ss");$("#dateime_id").html(c+" "+d)},addTab=function(a,b,c,d){0===a?addTabContent(b,c,d):1===a&&addTabHref(b,c,d)},addTabContent=function(a,b,c){if($("#tabs").tabs("exists",a))$("#tabs").tabs("select",a);else{"undefined"==typeof arguments[2]&&(c=!0);var d=document.createElement("iframe");d.src=b,d.scrolling="auto",d.frameBorder=0,d.height="100%",d.width="100%",d.attachEvent?d.attachEvent("onload",function(){ajaxLoadEnd()}):d.onload=function(){ajaxLoadEnd()},$("#tabs").tabs("add",{title:a,content:d,closable:c})}tabClose()},addTabHref=function(a,b,c){$("#tabs").tabs("exists",a)?$("#tabs").tabs("select",a):("undefined"==typeof arguments[2]&&(c=!0),$("#tabs").tabs("add",{title:a,href:b,closable:c})),tabClose()},onAddTab=function(){$("#tabs").tabs({onAdd:function(a,b){ajaxLoading("数据加载中...")}})},onUpdateTab=function(){$("#tabs").tabs({onUpdate:function(a){ajaxLoading("数据加载中...")}})},onLoadTab=function(){$("#tabs").tabs({onLoad:function(a){ajaxLoadEnd()}})},msgShow=function(a,b,c,d,e,f,g){$.messager.show({title:a,msg:b,timeout:d,showSpeed:e,showType:c,width:f,heigh:g})},msgAlert=function(a,b,c,d){/^e/.test(c)?c="error":/^q/.test(c)?c="question":/^i/.test(c)?c="info":/^w/.test(c)&&(c="warning"),$.messager.alert(a,b,c,d)},msgConfirm=function(a,b,c){$.messager.confirm(a,b,c)},msgPrompt=function(a,b,c){$.messager.prompt(a,b,c)},msgProgress=function(a,b,c,d){if(!a)return void $.messager.progress("close");$.messager.progress({title:b,msg:c,text:d})},msgValidationError=function(a){var b="",c=a.error_validations;if(c){var d=Object.keys(c);d.length&&(d.forEach(function(a){b=b+a+":"+c[a]+"<br/>"}),msgAlert(a.error_message,b,"i"))}},msgError=function(a){try{var b=JSON.parse(a.responseText);b.error_validations?msgValidationError(a):msgAlert(b.error_code,b.error_message,"i")}catch(c){msgAlert(a.statusText,"server error,please wait or contact us")}};oauth2.url="http://ec2-54-210-205-19.compute-1.amazonaws.com/admin/oncore/",oauth2.get=function(a,b,c,d){var e=oauth2.cookie.get("authToken"),f=$.ajax({url:a,type:"GET",data:b,headers:{Authorization:"Bearer "+e},dataType:"json"});f.done(c),f.fail(d)},oauth2.get_query=function(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(decodeURIComponent(e[0])==a)return decodeURIComponent(e[1])}},oauth2.isIos=function(){return null!=navigator.userAgent.match(/iPad|iPhone|iPod/i)},oauth2.post=function(a,b,c,d){$.ajax({url:a,type:"POST",contentType:"application/json",data:JSON.stringify(b),dataType:"json",success:c,error:d})},oauth2.postAuth=function(a,b,c,d){var e=oauth2.cookie.get("authToken");a=oauth2.url+a,$.ajax({url:a,type:"POST",contentType:"application/json",data:JSON.stringify(b),headers:{Authorization:"Bearer "+e},dataType:"json",success:c,error:d})},oauth2.deleteWithAuth=function(a,b,c){var d=oauth2.cookie.get("authToken");a=oauth2.url+a,$.ajax({url:a,type:"DELETE",contentType:"application/json",headers:{Authorization:"Bearer "+d},dataType:"json",success:b,error:c})},oauth2.putWithAuth=function(a,b,c,d){var e=oauth2.cookie.get("authToken");a=oauth2.url+a,$.ajax({url:a,type:"PUT",contentType:"application/json",data:JSON.stringify(b),headers:{Authorization:"Bearer "+e},dataType:"json",success:c,error:d})},oauth2.getWithAuth=function(a,b,c){a=oauth2.url+a;var d=oauth2.cookie.get("authToken");console.log(a),$.ajax({url:a,type:"GET",contentType:"application/json",headers:{Authorization:"Bearer "+d},dataType:"json",success:b,error:c})},oauth2.postClientAuth=function(a,b,c,d){a=oauth2.url+a;var e=btoa("353b302c44574f565045687e534e7d6a:286924697e615a672a646a493545646c");$.ajax({url:a,type:"POST",contentType:"application/json",data:JSON.stringify(b),headers:{Authorization:"Basic "+e},dataType:"json",success:c,error:d})},oauth2.login=function(a,b,c,d){var e=btoa("353b302c44574f565045687e534e7d6a:286924697e615a672a646a493545646c");$.ajax({url:a,type:"POST",accept:"application/json",data:b,headers:{Authorization:"Basic "+e},dataType:"json",success:c,error:d})},oauth2.put=function(a,b,c,d){var e=oauth2.cookie.get("authToken");$.ajax({url:a,type:"PUT",contentType:"application/json",data:JSON.stringify(b),headers:{Authorization:"Bearer "+e},dataType:"json",success:c,error:d})},oauth2.user={},oauth2.user.create=function(a,b,c,d,e){oauth2.postClientAuth("http://localhost:8080/users",{user:{firstName:a,emailAddress:b},password:c},function(a){oauth2.cookie.set("authToken",a.oauth2AccessToken.access_token),oauth2.cookie.set("userId",a.apiUser.id),oauth2.cookie.set("email",b),e()},function(a,b){e(a)})},oauth2.clientAuth=function(a,b){var c=[a+":"+b];return btoa(c)},oauth2.user.download=function(a){oauth2.get("http://localhost:8080/admin/me",{},function(b){return store.get("userResponse")===JSON.stringify(b)?(console.log("cached"),!1):(store.set("userResponse",JSON.stringify(b)),oauth2.user.user=b,void(a&&a()))},function(b,c){a&&a(b)})},oauth2.user.get=function(a){var b=store.get("userResponse");if(b){var c=JSON.parse(b);return oauth2.user.user=c,oauth2.user.download(a),a()}oauth2.user.download(a)},oauth2.user.is_logged_in=function(){return!!oauth2.cookie.get("authToken")},oauth2.user.login=function(a,b,c){oauth2.login("http://localhost:8080/oauth/token",{username:a,password:b,grant_type:"password"},function(b){oauth2.cookie.set("authToken",b.access_token),oauth2.cookie.set("email",a),c()},function(a,b){c(a)})},oauth2.user.logout=function(){oauth2.cookie.remove("authToken"),oauth2.cookie.remove("userId"),oauth2.cookie.remove("email"),store.clear(),window.location="index.html"},oauth2.user.reset_password=function(a,b,c){oauth2.post("v1.0/password/tokens/"+a,{password:b},function(a){c()},function(a,b){c(a)})},oauth2.user.send_reset_email=function(a,b){oauth2.post("v1.0/password/tokens",{emailAddress:a},function(a){b()},function(a,c){b(a)})},oauth2.user.updateName=function(a,b){oauth2.put("v1.0/users/"+oauth2.cookie.get("userId"),{emailAddress:oauth2.cookie.get("email"),firstName:a},function(a){console.log(a),b&&b(),oauth2.user.download()},function(a,c){b&&b(a),oauth2.user.download()})},oauth2.verify={},oauth2.verify.request_email=function(a,b){oauth2.post("v1.0/verify/tokens",{emailAddress:a},function(a){console.log(a),b()},function(a,c){b(a)})},oauth2.verify.verify=function(a,b){oauth2.post("v1.0/verify/tokens/"+a,{},function(a){b()},function(a,c){b(a)})};var module,root_folders_ToolBar=[{text:"add",iconCls:"icon-add",handler:function(){showAddRootFolder()}},{text:"edit",iconCls:"icon-edit",handler:function(){editRootFolder()}}],editIndex=void 0,modulesToolBar=[{text:"refresh",iconCls:"icon-reload",handler:function(){getModules()}},{text:"add",iconCls:"icon-add",handler:function(){showCreateModule()}},{text:"edit",iconCls:"icon-edit",handler:function(){editModule()}}];